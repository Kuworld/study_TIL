# 다형성(polymorphism)1

## 다형성 시작
 
 * 다형성은 객체지향 프로그래밍의 꽃이다.
 * `다형성(polymorphism)`은 이름 그대로 다양한 형태, 여러 형태를 가진다는 뜻으로
 * 한 객체가 여러타입의 객체로 취급될 수 있다는 것!
 * 일반적으론 하나의 객체는 하나의 타입으로 고정 되어 있다
 * 그러나, `다형성`을 사용하면 하나의 객체가 다른 타입으로 사용 될수 있다
* #### 다형적 참조의 핵심이론
    * `다형적 참조`
      * 부모와 자식이 있고, 각각 다른 메서드를 가진다
      * `Parent` : `parentMethod()`, `Child` : `childMethod()`
      * 부모변수가 자식 인스턴스를 참조 하는것이 가능하다 (다형적 참조)
      ```java
      //부모 변수가 자식 인스턴스 참조(다형적 참조)
        System.out.println("Parent -> Child");
        Parent poly = new Child();
        poly.parentMethod();
      ```
      * 그러나 자식이 부모를 담는 것은 불가능하다
      ```java
        Child child1 = new Parent(); //자식은 부모를 담을 수 없다. 컴파일 오류가 난다
      ```  
      * 부모탐입의 변수가 자식 인스터스를 참조하면 메모리상에 `Child` 와 `Parent` 가 모두 생성된다
      
      * 생성된 참조값을 부모타입 변수에 담아둔다
      
      * 부모 타입은 자식 타입을 담을 수 있다
       * `Parent poly = new Child()` : 성공
      *  반대로 자식 타입은 부모 타입을 담을 수 없다.
        * `Child child1 = new Parent()` : 컴파일 오류 발생
      * 부모 타입은 자신은 물론, 자식타입, 손자 타입까지 참조할 수 있다(`child` 하위에 손자가 있다면 가능) 
      * ### 다형적 참조의 한계
         *  부모가 자식을 참조하고 있는 상황에서 자식타입에 있는 메소드(`childMethod()`)를 호출할 수 없다
         *  상속 관계는 부모방향으로 올라갈 수는 있지만 자식 방향으로 내려갈 수는 없기 때문이다.
         *  부모 타입에는  자식타입에 대한 정보가 없기 때문에 호출이 불가
         *  호출이 가능하게 하려면 캐스팅이 필요하다.
    * `메서드 오버라이딩`

* #### 다형성과 캐스팅
  * // 다운캐스팅
  * `Child child = (Child) poly;` //Prent poly
  * `child.childMethod();` 
  * 이렇게 다운캐스팅을 해주면 자식타입의 기능을 호출할 수있게 된다.
  * **실행순서**
 ```java
    Child child = (Child) poly //다운캐스팅을 통해 부모타입을 자식 타입으로 변환한 다음에 대입 시도
    Child child = (Child) x001 //참조값을 읽은 다음 자식 타입으로 지정
    Child child = x001 //최종 결과
 ```
 * 캐스팅을 한다고 해서 `Parent poly`의 탕비이 변하는것이 아니고 참조값을 꺼낸뒤 커낸 참조값이 `Child`타입이 되는것. `poly`의 타입은 부모 타입으로 기존과 같이 유지된다.
 * #### 캐스팅의 종류
   * ##### 일시적 다운 캐스팅
```java
//일시적 다운캐스팅 - 해당 메서드를 호출하는 순간만 다운캐스팅
((Child) poly).childMethod();
```
    
   * poly는 부모 타입이다. 하지만 이렇게 하면 부모타입을 임시로(호출하는 순간만) 자식타입으로 변경한다. 메서드를 호출할 때 자식 타입에서 찾아 호출한다
   * `poly` 가 자식타입으로 바뀌는 것은 아니다
   * 참조값을 꺼내 참조값이 자식 타입이 되는것이다.
   * `poly`의 타입은 부모타입으로 그대로 유지된다
 * ##### 업캐스팅
   * 다운캐스팅과 반대로 자식을 부모타입으로 변경하는 것을 말한다
```java
자식 자식 = new 자식();
부모 부모1 = (부모) 자식; //업캐스팅은 생략 가능, 생략 권장
부모 부모2 = 자식; //업캐스팅 생략
```

   * 실행결과는 동일 하다
   * 업캐스팅은 생략할 수 있다. 다운캐스팅은 생략할 수 없다. 
   * 업캐스팅은 매우 자주 사용하기 떄문에 생략을 권장한다
   * 부모는 자식을 담을 있지만 그 반대는 안된다. (잊지말자!! 꼭기억해야됨)
* ##### 다운 캐스팅과 주의점
  * 다운캐스팅은 잘못하면 심학한 런타임 오류가 발생할 수있다
    * **컴파일 에러와 런타임 에러**
      * 컴파일 에러 : 변수명 오타, 잘못된 클래스 이름등으로 자바 프로그램이 실행되기 전에 발생 IDE에서 즉시 확인할 수 있기에 좋은 오류
      * 런타임 에러 : 이름 그대로 프로그램이 실행 되고 있는 도중 발생하는 오류로 사용자가 프로그램을 실행하는 도중 발생하기에 매우 좋지않은 오류다
  ```java
    부모 부모2 = new 부모();
    자식 자식2 = (자식) 부모2; //런타임 오류 - ClassCastException
    자식2.자식메소드(); //실행 불가
  ```  
    * `new 부모()` 는 부모 타입으로 객체를 생성한다. 
    * 따라서, 메모리에 자식 타입은 전혀 존재 하지 않는다.
    * 여기서는 문제가 발생하지 않지만
    * `자식 자식2 = (자식) 부모2;` 부모2를 자식 타입으로 다운캐스팅 했을때
    * 메모리상에 자식 자체가존재 하지 않으므로 자식의 기능을 사용할 수 없는것이다
    * 이렇게 사용할수 없는 타입으로 캐스팅을 하는 경우 `ClassCastException`이라는 예와ㅣ를 발생 시킨다
* ##### 다형성과 메서드 오버라이딩

    * 오버라이딩 된 메서드는 항상 우선권을 가진다
    * 오버라이딩은 부모타입에서 정의한 기능을 자식 타입에서 재정의 하는 것인데
    * 만약 자식에서도 오버라이딩 하고 손자에서도 오버라이딩을 하면 손자의 오버라이딩 메서드가 우선원을 가진다